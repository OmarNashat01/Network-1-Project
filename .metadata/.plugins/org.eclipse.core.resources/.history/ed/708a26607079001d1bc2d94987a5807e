/*
 * global.h
 *
 *  Created on: Dec 8, 2022
 *      Author: ranaa
 */

#ifndef GLOBAL_H_
#define GLOBAL_H_

#include <iostream>
#include <string>
#include <bitset>
#include <vector>
#include <fstream>
#include <bitset>
#include "Message_m.h"


#define MAX_SEQ 5
#define DELAY_ERROR 4.0
#define DUP_DELAY 0.1


using namespace std;

enum {
    intialization,
    frame_arrival,
    cksum_err,
    timeout,
    network_layer_ready,

};

enum {
    Modification,
    Loss,
    Duplication,
    Delay
};

struct mesToSend // saved in sending window
{
    bool isNone = 0;
    double delay = 0;
    string payload;
    bool dup = 0;
    bool lost = 0;
    bool mod = 0;

    void set(mesToSend mes){
        isNone = mes.isNone;
        delay = mes.delay;
        payload = mes.payload;
        dup = mes.dup;
        lost = mes.lost;
        mod = mes.mod;
    }

};

class window
{
protected:
    ifstream inFile;
    bool isSender;
    int wStart;
    int indToSend;
    int wEnd;
    mesToSend buffer[MAX_SEQ];

public:
    bool openFile(string filename){
        inFile.open(filename);
        if (inFile == NULL)
            return 0;
        else return 1;

    }
    bool ackFrame(int ack){
        //because seq_nr is incremented circularly
        if (((wStart<=ack) && (ack<wEnd)) || ((wEnd<wStart) && (wStart<=ack)) || ((ack<wEnd) && (wEnd<wStart)))
            return true;
        else
            return false;
    }
    bool canRead()  // Checks if there is space in sending window to store one more frame ( if not sender 0)
    {
        if(!isSender) return false;
        return calcFilledSlots(wStart) < 5;
    }
    bool readNext(fstream inFile);

};

#endif /* GLOBAL_H_ */
